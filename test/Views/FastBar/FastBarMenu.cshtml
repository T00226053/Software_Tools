@model CreateOrder
@{
    ViewData["Title"] = "Fast Bar";
}

<link rel="stylesheet" type="text/css" href="css/site.css" />


<div class="sellables-container">
    <div class="sellables">
        <div class="categories">
            <a class="category active" href="#">Beverages</a>
            <a class="category" href="#">Non-Alcoholic</a>
            <a class="category" href="#">Lunch Menu</a>
            <a class="category" href="#">Dinner Menu</a>
            <a class="category" href="#">Bar Snacks</a>
            <a class="category" href="#">Deals</a>
            <!-- Other categories -->
        </div>
        <div class="item-group-wrapper">
            <div class="item-group">
                <a href="#" class="item" data-item="Bud Light" data-price="3.00">Bud Light</a>
                <a href="#" class="item" data-item="Coca-Cola" data-price="1.50">Coca-Cola</a>
                <a href="#" class="item" data-item="Sprite" data-price="1.50">Sprite</a>
                <a href="#" class="item" data-item="Lemonade" data-price="2.00">Lemonade</a>
                <a href="#" class="item" data-item="Iced Tea" data-price="2.00">Iced Tea</a>
                <a href="#" class="item" data-item="Orange Juice" data-price="2.50">Orange Juice</a>
                <a href="#" class="item" data-item="Apple Juice" data-price="2.50">Apple Juice</a>
                <a href="#" class="item" data-item="Water" data-price="1.00">Water</a>
                <a href="#" class="item" data-item="Milk" data-price="2.50">Milk</a>
                <a href="#" class="item" data-item="Coffee" data-price="2.00">Coffee</a>
                <a href="#" class="item" data-item="Tea" data-price="1.50">Tea</a>
                <a href="#" class="item" data-item="Fruit Smoothie" data-price="3.50">Fruit Smoothie</a>
                <a href="#" class="item" data-item="Mango Shake" data-price="3.00">Mango Shake</a>
                <a href="#" class="item" data-item="Chocolate Milkshake" data-price="4.00">Chocolate Milkshake</a>
                <a href="#" class="item" data-item="Lemonade" data-price="2.00">Lemonade</a>
                <a href="#" class="item" data-item="Pineapple Juice" data-price="2.50">Pineapple Juice</a>
            </div>
        </div>
    </div>
    <div class="register-wrapper">
        <div class="customer">
            <input type="text" placeholder="Customer" />
        </div>
        <div class="register">
            <div class="products">
                <!-- Added items will be displayed here -->
            </div>

            <div class="pay-button">
                <a href="#" id="createOrderButton">Create Order</a>
            </div>
            <div id="total-price">Total: €0.00</div>
        </div>
    </div>
</div>

<script>
    const productsDiv = document.querySelector(".products");
    const createOrderButton = document.getElementById("createOrderButton");

    let totalPrice = 0;
    let errorMessageDisplayed = false;

    createOrderButton.addEventListener("click", (event) => {
        event.preventDefault();

        if (totalPrice > 0) {
            createOrder();
        } else if (!errorMessageDisplayed) {
            displayErrorMessage("No items selected for the order.");
            errorMessageDisplayed = true;
        }
    });

    const itemButtons = document.querySelectorAll(".item");
    itemButtons.forEach((button) => {
        button.addEventListener("click", (event) => {
            event.preventDefault();

            const itemName = button.getAttribute("data-item");
            const itemPrice = parseFloat(button.getAttribute("data-price"));

            const selectedProduct = document.createElement("div");
            selectedProduct.className = "product-bar selected";
            selectedProduct.innerHTML = `
                    <span>${itemName}</span>
                    <span>€${itemPrice.toFixed(2)}</span>
                `;

            productsDiv.appendChild(selectedProduct);

            totalPrice += itemPrice;
            updateTotalPrice();
        });
    });

    function updateTotalPrice() {
        const totalElement = document.getElementById("total-price");
        totalElement.textContent = `Total: €${totalPrice.toFixed(2)}`;
    }

    function createOrder() {
        const customerName = document.querySelector(".customer input").value;
        const selectedItems = getSelectedItems();

        fetch('/FastBar/CreateOrder', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                selectedItems: selectedItems,
                customerName: customerName,
            }),
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
            })
            .catch((error) => {
                console.error('Error:', error);
            });
    }

    function getSelectedItems() {
        const selectedItems = [];

        const productBars = document.querySelectorAll(".product-bar");
        productBars.forEach((productBar) => {
            const itemName = productBar.querySelector("span:first-child").textContent;
            const itemPrice = parseFloat(productBar.querySelector("span:last-child").textContent.replace("€", ""));

            selectedItems.push({
                itemName: itemName,
                itemPrice: itemPrice,
            });
        });

        return selectedItems;
    }

</script>
